1|第1章 引 言|1
2|1.1 BPF和eBPF是什么 |1
2|1.2 跟踪、嗅探、采样、剖析和可观测性分别是什么 |2
2|1.3 BCC、bpftrace和IO Visor |3
2|1.4 初识BCC：快速上手 |4
2|1.5 BPF跟踪的能见度 |7
2|1.6 动态插桩：kprobes和uprobes |8
2|1.7 静态插桩：tracepoint和USDT |9
2|1.8 初识bpftrace：跟踪open() |10
2|1.9 再回到BCC：跟踪open() |13
2|1.10 小结 |15
1|第2章 技术背景|16
2|2.1 图释BPF |16
2|2.2 BPF |17
2|2.3 扩展版BPF |18
2|2.4 调用栈回溯 |41
2|2.5 火焰图 |44
2|2.6 事件源 |48
2|2.7 kprobes |49
2|2.8 uprobes |53
2|2.9 跟踪点 |57
2|2.10 USDT |62
2|2.11 动态USDT |66
2|2.12 性能监控计数器 |68
2|2.13 perf_events |69
2|2.14 小结 |70
1|第3章 性能分析|71
2|3.1 概览 |71
2|3.2 性能分析方法论|73
2|3.3 Linux 60秒分析 |77
2|3.4 BCC工具检查清单 |84
2|3.5 小结 |90
1|第4章 BCC|91
2|4.1 BCC的组件 |92
2|4.2 BCC的特性 |92
2|4.3 安装BCC |94
2|4.4 BCC的工具|96
2|4.5 funccount |100
2|4.6 stackcount |105
2|4.7 trace |110
2|4.8 argdist |117
2|4.9 工具文档 |121
2|4.10 开发BCC工具 |126
2|4.11 BCC的内部实现 |127
2|4.12 BCC的调试 |128
2|4.13 小结 |136
1|第5章 bpftrace |137
2|5.1 bpftrace的组件 |138
2|5.2 bpftrace的特性 |139
2|5.3 bpftrace的安装 |141
2|5.4 bpftrace工具 |143
2|5.5 bpftrace单行程序 |145
2|5.6 bpftrace的文档 |146
2|5.7 bpftrace编程 |146
2|5.8 bpftrace的帮助信息 |155
2|5.9 bpftrace的探针类型 |157
2|5.10 bpftrace的控制流 |163
2|5.11 bpftrace的运算符 |164
2|5.12 bpftrace的变量 |165
2|5.13 bpftrace的函数 |170
2|5.14 bpftrace映射表的操作函数 |177
2|5.15 bpftrace的下一步工作 |183
2|5.16 bpftrace的内部运作 |185
2|5.17 bpftrace的调试 |186
2|5.18 小结 |190
1|第6章 CPU.|191
2|6.1 背景知识 |192
2|6.2 传统工具 |197
2|6.3 BPF工具 |210
2|6.4 BPF单行程序 |251
2|6.5 可选练习 |253
2|6.6 小结 |254
1|第7章 内存.|255
2|7.1 背景知识 |256
2|7.2 传统工具 |263
2|7.3 BPF工具 |269
2|7.4 BPF单行程序 |288
2|7.5 可选练习 |289
2|7.6 小结 |290
1|第8章 文件系统|291
2|8.1 背景知识 |292
2|8.2 传统工具 |296
2|8.3 BPF工具 |302
2|8.4 BPF单行程序 |353
2|8.5 可选练习 |359
2|8.6 小结 |360
1|第9章 磁盘I/O|361
2|9.1 背景知识 |362
2|9.2 传统工具 |367
2|9.3 BPF工具  |372
2|9.4 BPF单行程序 |406
2|9.5 可选练习 |409
2|9.6 小结 |410
1|第10章 网络|411
2|10.1 背景知识 |412
2|10.2 传统工具 |422
2|10.3 BPF工具  |433
2|10.4 BPF单行程序 |507
2|10.5 可选练习 |513
2|10.6 小结 |515
1|第11章 安全|516
2|11.1 背景知识 |516
2|11.2 BPF工具  |523
2|11.3 BPF单行程序 |542
2|11.4 小结 |544
1|第12章 编程语言.|545
2|12.1 背景知识 |545
2|12.2 C |551
2|12.3 Java |560
2|12.4 bash shell |601
2|12.5 其他语言 |614
2|12.6 小结 |619
1|第13章 应用程序.|620
2|13.1 背景知识 |621
2|13.2 BPF工具 |625
2|13.3 BPF单行程序 |662
2|13.4 BPF单行程序示范 |664
2|13.5 小结 |664
1|第14章 内核|665
2|14.1 背景知识 |666
2|14.2 分析策略 |669
2|14.3 传统工具 |670
2|14.4 BPF工具 |675
2|14.5 BPF单行程序 |697
2|14.6 BPF单行程序示范 |699
2|14.7 挑战 |700
2|14.8 小结 |700
1|第15章 容器|701
2|15.1 背景知识 |701
2|15.1.1 BPF 的分析能力 |703
2|15.1.2 挑战 |703
2|15.1.3 分析策略 |706
2|15.2 传统工具 |706
2|15.2.1 从主机上分析 |706
2|15.2.2 在容器内分析 |707
2|15.2.3 systemd-cgtop |707
2|15.2.4 kubectl top |708
2|15.2.5 docker stats |708
2|15.2.6 /sys/fs/cgroups |709
2|15.2.7 perf |709
2|15.3 BPF工具 |710
2|15.4 BPF单行程序 |717
2|15.5 可选练习 |717
2|15.6 小结 |718
1|第16章 虚拟机管理器|719
2|16.1 背景知识 |719
2|16.2 传统工具 |722
2|16.3 访客系统的BPF工具 |723
2|16.4 宿主机BPF工具 |732
2|16.5 小结 |737
1|第17章 其他BPF性能工具|738
2|17.1 Vector和Performance Co-Pilot（PCP） |738
2|17.2 Grafana和Performance Co-Pilot |747
2|17.3 Cloudflare eBPF Prometheus Exporter（配合Grafana） |750
2|17.4 kubectl-trace |752
2|17.5 其他工具 |755
2|17.6 小结 |755
1|第18章 建议、技巧和常见问题. |756
2|18.1 典型事件的频率和额外开销 |756
2|18.2 以49Hz或99Hz为采样频率 |760
2|18.3 黄猪和灰鼠 |760
2|18.4 开发目标软件 |762
2|18.5 学习系统调用 |763
2|18.6 保持简单 |764
2|18.7 事件缺失 |764
2|18.8 调用栈缺失 |766
2|18.9 打印时符号缺失（函数名称） |767
2|18.10 跟踪时函数缺失 |768
2|18.11 反馈回路 |769
2|18.12 被丢掉的事件 |769
1|附录A bpftrace单行程序|770
1|附录B bpftrace备忘单|775
1|附录C BCC工具的开发|778
1|附录D C.BPF. |793
1|附录E BPF指令|812
